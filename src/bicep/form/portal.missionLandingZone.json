{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
      "kind": "Form",
      "properties": {
        "title": "Mission Landing Zone",
        "steps": [
          {
            "name": "basics",
            "label": "Basics",
            "elements": [
              {
                "name": "infoBoxMissionLandingZone",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "text": "Mission Landing Zone is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/missionlz' for more details about the solution pattern.",
                  "style": "Info",
                  "uri": "https://aka.ms/missionlz"
                }
              },
              {
                "name": "deploymentDetails",
                "label": "Deployment Details",
                "type": "Microsoft.Common.Section",
                "visible": true,
                "elements": [
                  {
                    "name": "subscriptionApi",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "GET",
                      "path": "subscriptions?api-version=2020-01-01"
                    }
                  },
                  {
                    "name": "locationsApi",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "GET",
                      "path": "locations?api-version=2019-11-01"
                    }
                  },
                  {
                    "name": "deploymentDetailsText",
                    "type": "Microsoft.Common.TextBlock",
                    "visible": true,
                    "options": {
                      "text": "Select the subscription and location for your Mission Landing Zone deployment. This subscription will also provision the Mission Landing Zone Hub resources.",
                      "link": {
                        "label": "",
                        "uri": ""
                      }
                    }
                  },
                  {
                    "name": "hubSubscriptionId",
                    "label": "Hub Subscription",
                    "type": "Microsoft.Common.DropDown",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Select the Subscription for your Mission Landing Zone Hub network, firewall, and remote access resources.",
                    "multiselect": false,
                    "selectAll": false,
                    "filter": true,
                    "filterPlaceholder": "Filter items ...",
                    "multiLine": true,
                    "constraints": {
                      "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                      "required": true
                    }
                  },
                  {
                    "name": "identitySubscriptionId",
                    "label": "Identity Subscription",
                    "type": "Microsoft.Common.DropDown",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Select the Subscription for your Mission Landing Zone Identity network.",
                    "multiselect": false,
                    "selectAll": false,
                    "filter": true,
                    "filterPlaceholder": "Filter items ...",
                    "multiLine": true,
                    "constraints": {
                      "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                      "required": true
                    }
                  },
                  {
                    "name": "operationsSubscriptionId",
                    "label": "Operations Subscription",
                    "type": "Microsoft.Common.DropDown",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Select the Subscription for your Mission Landing Zone Operations network.",
                    "multiselect": false,
                    "selectAll": false,
                    "filter": true,
                    "filterPlaceholder": "Filter items ...",
                    "multiLine": true,
                    "constraints": {
                      "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                      "required": true
                    }
                  },
                  {
                    "name": "sharedServicesSubscriptionId",
                    "label": "Shared Services Subscription",
                    "type": "Microsoft.Common.DropDown",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Select the Subscription for your Mission Landing Zone Shared Services network.",
                    "multiselect": false,
                    "selectAll": false,
                    "filter": true,
                    "filterPlaceholder": "Filter items ...",
                    "multiLine": true,
                    "constraints": {
                      "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                      "required": true
                    }
                  },
                  {
                    "name": "infoBoxLocation",
                    "type": "Microsoft.Common.InfoBox",
                    "visible": true,
                    "options": {
                      "text": "Since not all service features are available in all regions, Mission Landing Zone is available in a subset of regions.",
                      "style": "Info"
                    }
                  },
                  {
                    "name": "locationName",
                    "label": "Location",
                    "type": "Microsoft.Common.DropDown",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Select the Location for your Mission Landing Zone.",
                    "multiselect": false,
                    "selectAll": false,
                    "filter": true,
                    "filterPlaceholder": "Filter items ...",
                    "multiLine": true,
                    "constraints": {
                      "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('eastus,eastus2,southcentralus,westus,westus2,usgovvirginia,usgovarizona,ussec,usnat', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                      "required": true
                    }
                  }
                ]
              },
              {
                "name": "missionLandingZoneName",
                "label": "Mission Landing Zone Name",
                "type": "Microsoft.Common.Section",
                "visible": true,
                "elements": [
                  {
                    "name": "missionLandingZonePrefix",
                    "label": "Resource Naming Prefix",
                    "type": "Microsoft.Common.TextBox",
                    "visible": true,
                    "defaultValue": "",
                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers) to prepend to all resources.",
                    "constraints": {
                      "required": true,
                      "validations": [
                        {
                          "regex": "^[a-z0-9]{1,10}$",
                          "message": "The prefix must be between 1-10 lowercase characters and numbers."
                        },
                        {
                          "isValid": "[not(equals(steps('basics').missionLandingZoneName.storageAccountNameApi001.nameAvailable, false))]",
                          "message": "Prefix currently unavailable. Please choose a different one."
                        },
                        {
                          "isValid": "[not(equals(steps('basics').missionLandingZoneName.storageAccountNameApi002.nameAvailable, false))]",
                          "message": "Prefix currently unavailable. Please choose a different one."
                        },
                        {
                          "isValid": "[not(equals(steps('basics').missionLandingZoneName.storageAccountNameApi003.nameAvailable, false))]",
                          "message": "Prefix currently unavailable. Please choose a different one."
                        },
                        {
                          "isValid": "[not(equals(steps('basics').missionLandingZoneName.storageAccountNameApi004.nameAvailable, false))]",
                          "message": "Prefix currently unavailable. Please choose a different one."
                        }
                      ]
                    }
                  },
                  {
                    "name": "storageAccountNameApi001",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "POST",
                      "path": "[concat(steps('basics').deploymentDetails.hubSubscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                      "body": {
                        "name": "[concat('stdiag', steps('basics').missionLandingZoneName.missionLandingZonePrefix, 'hub')]",
                        "type": "Microsoft.Storage/storageAccounts"
                      }
                    }
                  },
                  {
                    "name": "storageAccountNameApi002",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "POST",
                      "path": "[concat(steps('basics').deploymentDetails.identitySubscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                      "body": {
                        "name": "[concat('stdiag', steps('basics').missionLandingZoneName.missionLandingZonePrefix, 'identity')]",
                        "type": "Microsoft.Storage/storageAccounts"
                      }
                    }
                  },
                  {
                    "name": "storageAccountNameApi003",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "POST",
                      "path": "[concat(steps('basics').deploymentDetails.operationsSubscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                      "body": {
                        "name": "[concat('stdiag', steps('basics').missionLandingZoneName.missionLandingZonePrefix, 'operation')]",
                        "type": "Microsoft.Storage/storageAccounts"
                      }
                    }
                  },
                  {
                    "name": "storageAccountNameApi004",
                    "type": "Microsoft.Solutions.ArmApiControl",
                    "request": {
                      "method": "POST",
                      "path": "[concat(steps('basics').deploymentDetails.sharedServicesSubscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                      "body": {
                        "name": "[concat('stdiag', steps('basics').missionLandingZoneName.missionLandingZonePrefix, 'sharesvc')]",
                        "type": "Microsoft.Storage/storageAccounts"
                      }
                    }
                  }
                ]
              }
            ]
          },
          {
            "name": "networking",
            "label": "Networking",
            "elements": []
          },
          {
            "name": "policy",
            "label": "Policy",
            "elements": []
          },
          {
            "name": "remoteAccess",
            "label": "Remote Access",
            "elements": []
          }
        ],
        "outputs": {
        }
      }
    }
  }